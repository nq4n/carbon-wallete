# إعداد Supabase للمحفظة الكربونية الرقمية

## الخطوات المطلوبة

### 1. إنشاء مشروع Supabase جديد
1. اذهب إلى [Supabase](https://supabase.com)
2. أنشئ حساباً جديداً أو سجل الدخول
3. أنشئ مشروعاً جديداً
4. احتفظ بـ URL و anon key الخاص بمشروعك

### 2. إعداد متغيرات البيئة
أنشئ ملف `.env.local` في جذر المشروع وأضف:

```env
NEXT_PUBLIC_SUPABASE_URL=your_supabase_project_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
```

### 3. تشغيل أوامر SQL
1. اذهب إلى SQL Editor في لوحة تحكم Supabase
2. انسخ والصق محتوى ملف `/database/setup.sql`
3. شغل الأوامر لإنشاء الجداول والسياسات

### 4. إعداد التوثيق (Authentication)
1. اذهب إلى Authentication في لوحة تحكم Supabase
2. في Settings، تأكد من تفعيل:
   - Enable email confirmations (اختياري)
   - Enable secure email change (اختياري)

### 5. إعداد Row Level Security (RLS)
تأكد من أن RLS مفعل على جميع الجداول (تم في ملف setup.sql)

### 6. بيانات تجريبية
تم إنشاء حساب تجريبي:
- البريد الإلكتروني: demo@squ.edu.om
- كلمة المرور: demo123

## ميزات النظام

### المصادقة
- تسجيل الدخول والخروج
- إنشاء حساب جديد للطلاب والموظفين
- إدارة الملف الشخصي

### قاعدة البيانات
- ملفات المستخدمين (user_profiles)
- الأنشطة البيئية (activities)
- مشتريات المتجر الأخضر (green_store_purchases)
- نتائج الاختبارات (quiz_results)
- تقدم التعلم (learning_progress)

### الأمان
- Row Level Security على جميع الجداول
- المستخدمون يمكنهم فقط الوصول إلى بياناتهم الخاصة
- تشفير كلمات المرور بواسطة Supabase

### التحديث التلقائي للنقاط
- تحديث النقاط تلقائياً عند إضافة:
  - أنشطة بيئية جديدة
  - إكمال اختبارات
  - إكمال محتوى تعليمي

## استكشاف الأخطاء

### خطأ في الاتصال بقاعدة البيانات
- تأكد من صحة URL و anon key
- تأكد من وجود ملف .env.local

### خطأ في الصلاحيات
- تأكد من تشغيل أوامر setup.sql
- تأكد من تفعيل RLS على الجداول

### مشاكل في التسجيل
- تأكد من إعداد Authentication في Supabase
- تأكد من عمل triggers لتحديث النقاط

## ملاحظات مهمة
- لا تشارك anon key الخاص بك
- استخدم environment variables للمعلومات الحساسة
- تأكد من نسخ البيانات احتياطياً بانتظام